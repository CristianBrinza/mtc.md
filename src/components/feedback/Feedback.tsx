import React, { useState } from 'react';
import styles from './Feedback.module.css';
import Popup from '../Popup/Popup.tsx';
import Button from '../Button.tsx';
import Icon from '../Icon.tsx';

const Feedback: React.FC = () => {
  const [showPopup, setShowPopup] = useState<boolean>(false);
  const closePopup = () => {
    setShowPopup(false);
  };

  const [answers, setAnswers] = useState<{ [key: string]: number }>({
    good: 0,
  });

  const choseStars = (question: string, rating: number) => {
    setAnswers(prev => {
      const updatedAnswers = { ...prev, [question]: rating };
      localStorage.setItem('feedbackAnswers', JSON.stringify(updatedAnswers));
      return updatedAnswers;
    });
  };

  const [improvement, setImprovement] = useState<string>('');
  const handleTextChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    setImprovement(e.target.value);
  };
  return (
    <>
      <div className={styles.feedback_icon} onClick={() => setShowPopup(true)}>
        <svg
          width="36"
          height="96"
          viewBox="0 0 36 96"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M6 96C2.68629 96 -1.17422e-07 93.3137 -2.62268e-07 90L-3.93402e-06 6C-4.07887e-06 2.68629 2.68629 -1.17422e-07 6 -2.62268e-07L36 -1.57361e-06L36 96L6 96Z"
            fill="#F7F7F7"
          />
          <path
            d="M24 79.672L13.536 79.672L13.536 73.352L15.104 73.352L15.104 77.816L18.064 77.816L18.064 74.008L19.632 74.008L19.632 77.816L24 77.816L24 79.672ZM24.192 68.5657C24.192 69.2911 24.032 69.9471 23.712 70.5337C23.3813 71.1204 22.912 71.5844 22.304 71.9257C21.6853 72.2671 20.944 72.4377 20.08 72.4377C19.2267 72.4377 18.4907 72.2671 17.872 71.9257C17.2533 71.5737 16.7787 71.1204 16.448 70.5657C16.1173 70.0111 15.952 69.4297 15.952 68.8217C15.952 68.1071 16.112 67.5097 16.432 67.0297C16.7413 66.5497 17.1787 66.1871 17.744 65.9417C18.2987 65.6964 18.944 65.5737 19.68 65.5737C20.064 65.5737 20.3627 65.6004 20.576 65.6537L20.576 70.6457C21.2693 70.5604 21.808 70.3097 22.192 69.8937C22.576 69.4777 22.768 68.9551 22.768 68.3257C22.768 67.9844 22.72 67.6697 22.624 67.3817C22.5173 67.0831 22.3733 66.7897 22.192 66.5017L23.344 65.8777C23.5893 66.2511 23.792 66.6671 23.952 67.1257C24.112 67.5844 24.192 68.0644 24.192 68.5657ZM19.328 70.6617L19.328 67.1737C18.72 67.1737 18.2453 67.3071 17.904 67.5737C17.552 67.8404 17.376 68.2404 17.376 68.7737C17.376 69.2324 17.5467 69.6431 17.888 70.0057C18.2187 70.3577 18.6987 70.5764 19.328 70.6617ZM24.192 60.4564C24.192 61.1817 24.032 61.8377 23.712 62.4244C23.3813 63.011 22.912 63.475 22.304 63.8164C21.6853 64.1577 20.944 64.3284 20.08 64.3284C19.2267 64.3284 18.4907 64.1577 17.872 63.8164C17.2533 63.4644 16.7787 63.011 16.448 62.4564C16.1173 61.9017 15.952 61.3204 15.952 60.7124C15.952 59.9977 16.112 59.4004 16.432 58.9204C16.7413 58.4404 17.1787 58.0777 17.744 57.8324C18.2987 57.587 18.944 57.4644 19.68 57.4644C20.064 57.4644 20.3627 57.491 20.576 57.5444L20.576 62.5364C21.2693 62.451 21.808 62.2004 22.192 61.7844C22.576 61.3684 22.768 60.8457 22.768 60.2164C22.768 59.875 22.72 59.5604 22.624 59.2724C22.5173 58.9737 22.3733 58.6804 22.192 58.3924L23.344 57.7684C23.5893 58.1417 23.792 58.5577 23.952 59.0164C24.112 59.475 24.192 59.955 24.192 60.4564ZM19.328 62.5524L19.328 59.0644C18.72 59.0644 18.2453 59.1977 17.904 59.4644C17.552 59.731 17.376 60.131 17.376 60.6644C17.376 61.123 17.5467 61.5337 17.888 61.8964C18.2187 62.2484 18.6987 62.467 19.328 62.5524ZM24.192 52.955C24.192 53.9363 23.8293 54.7203 23.104 55.307C22.3787 55.8937 21.3707 56.187 20.08 56.187C19.2267 56.187 18.4907 56.0323 17.872 55.723C17.2533 55.403 16.7787 54.987 16.448 54.475C16.1173 53.963 15.952 53.4243 15.952 52.859C15.952 52.411 16.032 52.0323 16.192 51.723C16.3413 51.403 16.5493 51.0937 16.816 50.795L15.552 50.859L12.704 50.859L12.704 49.019L24 49.019L24 50.539L23.152 50.667L23.152 50.731C23.44 51.019 23.6853 51.355 23.888 51.739C24.0907 52.123 24.192 52.5283 24.192 52.955ZM22.672 52.507C22.672 51.9203 22.3787 51.371 21.792 50.859L18.128 50.859C17.8827 51.1257 17.712 51.3923 17.616 51.659C17.52 51.9257 17.472 52.1923 17.472 52.459C17.472 52.9603 17.7013 53.3923 18.16 53.755C18.608 54.107 19.2427 54.283 20.064 54.283C20.9067 54.283 21.552 54.1283 22 53.819C22.448 53.5097 22.672 53.0723 22.672 52.507ZM24.192 42.8677C24.192 43.6144 23.8507 44.3291 23.168 45.0117L23.168 45.0597L24 45.2197L24 46.6757L12.704 46.6757L12.704 44.8357L15.616 44.8357L16.928 44.8837C16.64 44.5531 16.4053 44.1904 16.224 43.7957C16.0427 43.4011 15.952 43.0064 15.952 42.6117C15.952 41.6304 16.3147 40.8677 17.04 40.3237C17.7653 39.7797 18.7307 39.5077 19.936 39.5077C20.832 39.5077 21.6 39.6677 22.24 39.9877C22.8693 40.3077 23.3547 40.7237 23.696 41.2357C24.0267 41.7371 24.192 42.2811 24.192 42.8677ZM22.672 43.2517C22.672 42.7291 22.4427 42.2917 21.984 41.9397C21.5253 41.5877 20.8533 41.4117 19.968 41.4117C19.1787 41.4117 18.5653 41.5451 18.128 41.8117C17.6907 42.0784 17.472 42.5104 17.472 43.1077C17.472 43.6624 17.7653 44.2384 18.352 44.8357L22.016 44.8357C22.2507 44.5584 22.4213 44.2864 22.528 44.0197C22.624 43.7424 22.672 43.4864 22.672 43.2517ZM24.192 35.9436C24.192 36.6263 23.9787 37.1863 23.552 37.6236C23.1253 38.0503 22.5707 38.2636 21.888 38.2636C21.0453 38.2636 20.3947 37.8956 19.936 37.1596C19.4667 36.4236 19.1467 35.2503 18.976 33.6396C18.56 33.6503 18.2027 33.7623 17.904 33.9756C17.5947 34.1783 17.44 34.5463 17.44 35.0796C17.44 35.4636 17.5147 35.8423 17.664 36.2156C17.8133 36.5783 17.9947 36.9356 18.208 37.2876L16.976 37.9596C16.6987 37.5223 16.4587 37.0316 16.256 36.4876C16.0533 35.933 15.952 35.3463 15.952 34.7276C15.952 33.7463 16.2453 33.0156 16.832 32.5356C17.408 32.045 18.2453 31.7996 19.344 31.7996L24 31.7996L24 33.3196L23.136 33.4476L23.136 33.5116C23.4347 33.8636 23.6853 34.2423 23.888 34.6476C24.0907 35.0423 24.192 35.4743 24.192 35.9436ZM22.752 35.3516C22.752 35.0316 22.6773 34.7436 22.528 34.4876C22.368 34.221 22.1547 33.9383 21.888 33.6396L20.128 33.6396C20.2667 34.7063 20.4747 35.4476 20.752 35.8636C21.0187 36.2796 21.3493 36.4876 21.744 36.4876C22.096 36.4876 22.352 36.381 22.512 36.1676C22.672 35.9543 22.752 35.6823 22.752 35.3516ZM24.192 26.3176C24.192 27.0323 24.032 27.6776 23.712 28.2536C23.3813 28.819 22.912 29.2723 22.304 29.6136C21.6853 29.9443 20.944 30.1096 20.08 30.1096C19.2053 30.1096 18.464 29.9283 17.856 29.5656C17.2373 29.203 16.768 28.723 16.448 28.1256C16.1173 27.5176 15.952 26.867 15.952 26.1736C15.952 25.6723 16.0373 25.235 16.208 24.8616C16.3787 24.4883 16.5867 24.1576 16.832 23.8696L18.032 24.7656C17.8507 24.9683 17.712 25.1763 17.616 25.3896C17.5093 25.603 17.456 25.8323 17.456 26.0776C17.456 26.707 17.696 27.2243 18.176 27.6296C18.656 28.0243 19.2907 28.2216 20.08 28.2216C20.8587 28.2216 21.488 28.0296 21.968 27.6456C22.448 27.251 22.688 26.7443 22.688 26.1256C22.688 25.8163 22.624 25.5283 22.496 25.2616C22.3573 24.9843 22.1973 24.7336 22.016 24.5096L23.232 23.7576C23.552 24.1203 23.792 24.5256 23.952 24.9736C24.112 25.4216 24.192 25.8696 24.192 26.3176ZM24 22.207L12.704 22.207L12.704 20.399L19.76 20.399L19.76 20.351L16.144 17.439L16.144 15.423L19.344 18.111L24 15.151L24 17.151L20.592 19.167L22 20.399L24 20.399L24 22.207Z"
            fill="#333333"
          />
        </svg>
      </div>

      <Popup id="1284768" isVisible={showPopup} onClose={closePopup}>
        <div className={`popup_content ${styles.feedback_form}`}>
          <div className={styles.feedback_title}>Mulțumim pentru feedback</div>
          {/*<span className={styles.feedback_subtitle}> Părerea ta e foarte importantă pentru noi ❤️</span> <br/><br/>*/}

          <span style={{ color: '#2f2f2f' }}>
            Cum evaluezi experiența ta pe www.moldtelecom.md?
          </span>

          <div className={styles.FeedbackMenu_stars}>
            {[1, 2, 3, 4, 5].map(star => (
              <Icon
                key={star}
                onClick={() => choseStars('design', star)}
                type={star <= answers.design ? 'star_fill' : 'star'}
                color={star <= answers.design ? '#3a3a3a' : '#939393'}
              />
            ))}
          </div>

          <span style={{ color: '#2f2f2f' }}> Te rugăm să lași un mesaj:</span>

          <textarea
            value={improvement}
            onChange={handleTextChange}
            placeholder="Lasa-ne numarul daca doresesti sa fii contactat"
            className={styles.feedback_textarea}
          ></textarea>

          <Button>Trimite</Button>
        </div>
      </Popup>
    </>
  );
};

export default Feedback;
